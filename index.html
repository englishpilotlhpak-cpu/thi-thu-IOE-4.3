<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BỘ ĐỀ ÔN IOE K4 SỐ: 02.1</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&display=swap');
        body {
            font-family: 'Baloo 2', cursive;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .word-block {
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        audio {
            filter: sepia(20%) saturate(70%) grayscale(1) contrast(99%) brightness(90%);
        }
    </style>
</head>
<body class="bg-blue-50 font-sans antialiased text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- DỮ LIỆU CÂU HỎI IOE LỚP 4 (ĐỀ SỐ 02.1) - 100 CÂU ---
        const questions = [
            {
                type: 'fill-in-the-blank',
                question: '1. __ you like Music? – No, I don’t.',
                correctAnswer: 'Do',
                correctAnswer_vi: 'Do',
                hint_vi: 'Câu hỏi Yes/No ở thì hiện tại đơn. (2 ký tự)',
                rationale_vi: 'Câu trả lời dùng "don’t", vậy câu hỏi phải dùng trợ động từ "Do".',
                rationale_en: 'The answer uses "don’t", so the question must use the auxiliary verb "Do".'
            },
            {
                type: 'rearrange',
                question: '2. month/ of/ the year./ is the tenth/ October/',
                words: ['October', 'is the tenth', 'month', 'of', 'the year.'],
                correctAnswer: 'October is the tenth month of the year.',
                correctAnswer_vi: 'Tháng Mười là tháng thứ mười của năm.',
                hint_vi: 'Sắp xếp câu để miêu tả tháng Mười.',
                rationale_vi: 'Cấu trúc câu: Chủ ngữ (October) + động từ to be (is) + vị ngữ (the tenth month of the year).',
                rationale_en: 'Sentence structure: Subject (October) + verb to be (is) + predicate (the tenth month of the year).'
            },
            {
                type: 'mc',
                question: '3. I don’t go to school ___ Saturday and Sunday.',
                options: [
                    { text: 'A. from', isCorrect: false },
                    { text: 'B. at', isCorrect: false },
                    { text: 'C. in', isCorrect: false },
                    { text: 'D. on', isCorrect: true }
                ],
                correctAnswer: 'D. on',
                correctAnswer_vi: 'on',
                hint_vi: 'Giới từ đi với các ngày trong tuần.',
                rationale_vi: 'Chúng ta sử dụng giới từ "on" trước các ngày trong tuần (on Saturday, on Sunday).',
                rationale_en: 'We use the preposition "on" before days of the week (on Saturday, on Sunday).'
            },
            {
                type: 'rearrange',
                question: '4. listens to/ in/ the evenings./ music/ Nam/',
                words: ['Nam', 'listens to', 'music', 'in', 'the evenings.'],
                correctAnswer: 'Nam listens to music in the evenings.',
                correctAnswer_vi: 'Nam nghe nhạc vào các buổi tối.',
                hint_vi: 'Câu miêu tả thói quen của Nam.',
                rationale_vi: 'Cấu trúc câu thì hiện tại đơn: S + V(s/es) + O + cụm từ chỉ thời gian.',
                rationale_en: 'Simple present tense structure: S + V(s/es) + O + time phrase.'
            },
            {
                type: 'mc',
                question: '5. Mai does her homework ... eight o’clock.',
                options: [
                    { text: 'A. at', isCorrect: true },
                    { text: 'B. on', isCorrect: false },
                    { text: 'C. in', isCorrect: false },
                    { text: 'D. for', isCorrect: false }
                ],
                correctAnswer: 'A. at',
                correctAnswer_vi: 'lúc',
                hint_vi: 'Giới từ đi với giờ cụ thể.',
                rationale_vi: 'Chúng ta dùng giới từ "at" trước một giờ cụ thể (at eight o’clock).',
                rationale_en: 'We use the preposition "at" before a specific time (at eight o’clock).'
            },
            {
                type: 'fill-in-the-blank',
                question: '6. There __ a desk in my room.',
                correctAnswer: 'is',
                correctAnswer_vi: 'is',
                hint_vi: 'Cấu trúc "There is" với danh từ số ít. (2 ký tự)',
                rationale_vi: '"a desk" là danh từ số ít, vì vậy chúng ta dùng "There is".',
                rationale_en: '"a desk" is a singular noun, so we use "There is".'
            },
            {
                type: 'rearrange',
                question: '7. basketball after/ playing/ he like/ school?/ Does/',
                words: ['Does', 'he like', 'playing', 'basketball after', 'school?'],
                correctAnswer: 'Does he like playing basketball after school?',
                correctAnswer_vi: 'Anh ấy có thích chơi bóng rổ sau giờ học không?',
                hint_vi: 'Câu hỏi Yes/No với "like + V-ing".',
                rationale_vi: 'Cấu trúc câu hỏi Yes/No ở thì hiện tại đơn: Does + S + V(nguyên mẫu)...? Sau "like" là V-ing.',
                rationale_en: 'Yes/No question structure in simple present: Does + S + V(infinitive)...? After "like" comes V-ing.'
            },
            {
                type: 'fill-in-the-blank',
                question: '8. H__ old is your father?',
                correctAnswer: 'ow',
                correctAnswer_vi: 'ow',
                hint_vi: 'Câu hỏi về tuổi tác. (2 ký tự)',
                rationale_vi: 'Cụm từ "How old" dùng để hỏi tuổi.',
                rationale_en: 'The phrase "How old" is used to ask about age.'
            },
            {
                type: 'rearrange',
                question: '9. now, Mai? –/ What are/ comic book./ you doing/ I’m reading a/',
                words: ['What are', 'you doing', 'now, Mai?', '–', 'I’m reading a', 'comic book.'],
                correctAnswer: 'What are you doing now, Mai? – I’m reading a comic book.',
                correctAnswer_vi: 'Bạn đang làm gì vậy Mai? – Tôi đang đọc một cuốn truyện tranh.',
                hint_vi: 'Một đoạn hội thoại ngắn.',
                rationale_vi: 'Đây là câu hỏi và câu trả lời ở thì hiện tại tiếp diễn, hỏi về hành động đang xảy ra.',
                rationale_en: 'This is a question and answer in the present continuous tense, asking about an action in progress.'
            },
            {
                type: 'mc',
                question: '10. What class is Phong ___? – He’s ___ class 4B.',
                options: [
                    { text: 'A. in/in', isCorrect: true },
                    { text: 'B. on/on', isCorrect: false },
                    { text: 'C. in/on', isCorrect: false },
                    { text: 'D. at/at', isCorrect: false }
                ],
                correctAnswer: 'A. in/in',
                correctAnswer_vi: 'trong/trong',
                hint_vi: 'Giới từ chỉ "ở trong lớp".',
                rationale_vi: 'Chúng ta dùng giới từ "in" để nói ai đó học ở lớp nào (in class 4B).',
                rationale_en: 'We use the preposition "in" to say someone is in a particular class (in class 4B).'
            },
            {
                type: 'fill-in-the-blank',
                question: '11. My birthday is in Sept_mber.',
                correctAnswer: 'e',
                correctAnswer_vi: 'e',
                hint_vi: 'Tên của tháng Chín. (1 ký tự)',
                rationale_vi: 'Từ đúng là "September" (Tháng Chín).',
                rationale_en: 'The correct word is "September".'
            },
            {
                type: 'rearrange',
                question: '12. are/ things./ Fish and chicken/ favourite/ Nga\'s/',
                words: ['Fish and chicken', 'are', 'Nga\'s', 'favourite', 'things.'],
                correctAnswer: 'Fish and chicken are Nga\'s favourite things.',
                correctAnswer_vi: 'Cá và gà là những thứ yêu thích của Nga.',
                hint_vi: 'Câu nói về món ăn yêu thích.',
                rationale_vi: 'Chủ ngữ số nhiều (Fish and chicken) đi với động từ "are". "Nga\'s favourite things" là cụm danh từ.',
                rationale_en: 'The plural subject (Fish and chicken) goes with the verb "are". "Nga\'s favourite things" is a noun phrase.'
            },
            {
                type: 'mc',
                question: '13. I would like an apple. – Here you ... .',
                options: [
                    { text: 'A. is', isCorrect: false },
                    { text: 'B. are', isCorrect: true },
                    { text: 'C. a', isCorrect: false },
                    { text: 'D. an', isCorrect: false }
                ],
                correctAnswer: 'B. are',
                correctAnswer_vi: 'are',
                hint_vi: 'Cụm từ cố định khi đưa cho ai đó thứ gì.',
                rationale_vi: '"Here you are" là một cụm từ cố định có nghĩa là "Của bạn đây", được dùng khi đưa cho ai đó một vật mà họ muốn.',
                rationale_en: '"Here you are" is a fixed phrase meaning "This is for you," used when giving someone something they want.'
            },
            {
                type: 'multimedia',
                question: '14. This ba___a is for you, Mary. – Thank you.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207426256256193_566X320.jpg',
                correctAnswer: 'nan',
                correctAnswer_vi: 'nan',
                hint_vi: 'Loại quả màu vàng trong hình. (3 ký tự)',
                rationale_vi: 'Quả trong hình là quả chuối (banana).',
                rationale_en: 'The fruit in the picture is a banana.'
            },
            {
                type: 'fill-in-the-blank',
                question: '15. There are ____ days in a week.',
                correctAnswer: 'seven',
                correctAnswer_vi: 'bảy',
                hint_vi: 'Một tuần có bao nhiêu ngày? (5 ký tự)',
                rationale_vi: 'Một tuần có bảy (seven) ngày.',
                rationale_en: 'There are seven days in a week.'
            },
            {
                type: 'multimedia',
                question: '16. I can dance and I can j___.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D4_8.mp3',
                correctAnswer: 'ump',
                correctAnswer_vi: 'ump',
                hint_vi: 'Nghe và điền động từ chỉ hành động. (3 ký tự)',
                rationale_vi: 'Bài nghe nói "I can dance and I can jump" (Tôi có thể nhảy múa và tôi có thể nhảy).',
                rationale_en: 'The audio says "I can dance and I can jump".'
            },
            {
                type: 'fill-in-the-blank',
                question: '17. How many students are t____ in your class?',
                correctAnswer: 'here',
                correctAnswer_vi: 'here',
                hint_vi: 'Cấu trúc hỏi số lượng. (4 ký tự)',
                rationale_vi: 'Cấu trúc hỏi số lượng là "How many ... are there ...?".',
                rationale_en: 'The structure to ask for quantity is "How many ... are there ...?".'
            },
            {
                type: 'rearrange',
                question: '18. there in your/ school bag?/ How many/ notebooks are/',
                words: ['How many', 'notebooks are', 'there in your', 'school bag?'],
                correctAnswer: 'How many notebooks are there in your school bag?',
                correctAnswer_vi: 'Có bao nhiêu quyển vở trong cặp sách của bạn?',
                hint_vi: 'Câu hỏi với "How many".',
                rationale_vi: 'Cấu trúc: How many + N(số nhiều) + are there + ...?',
                rationale_en: 'Structure: How many + N(plural) + are there + ...?'
            },
            {
                type: 'fill-in-the-blank',
                question: '19. Tommy can sp__k Vietnamese.',
                correctAnswer: 'ea',
                correctAnswer_vi: 'ea',
                hint_vi: 'Từ có nghĩa là "nói". (2 ký tự)',
                rationale_vi: 'Động từ "speak" có nghĩa là nói (một ngôn ngữ).',
                rationale_en: 'The verb "speak" means to say words (in a language).'
            },
            {
                type: 'fill-in-the-blank',
                question: '20. Ha can dance ___ cannot play football.',
                correctAnswer: 'but',
                correctAnswer_vi: 'but',
                hint_vi: 'Từ nối chỉ sự đối lập. (3 ký tự)',
                rationale_vi: 'Liên từ "but" (nhưng) được dùng để nối hai mệnh đề có ý nghĩa tương phản.',
                rationale_en: 'The conjunction "but" is used to connect two clauses with contrasting ideas.'
            },
            {
                type: 'mc',
                question: '21. _______ is my hobby.',
                options: [
                    { text: 'A. Swim', isCorrect: false },
                    { text: 'B. Swims', isCorrect: false },
                    { text: 'C. Swiming', isCorrect: false },
                    { text: 'D. Swimming', isCorrect: true }
                ],
                correctAnswer: 'D. Swimming',
                correctAnswer_vi: 'Bơi lội',
                hint_vi: 'Sở thích là một danh động từ (V-ing).',
                rationale_vi: 'Để làm chủ ngữ trong câu, động từ "swim" phải được chuyển thành danh động từ "Swimming". "Swiming" sai chính tả.',
                rationale_en: 'To act as the subject of the sentence, the verb "swim" must be converted to the gerund "Swimming". "Swiming" is misspelled.'
            },
            {
                type: 'multimedia',
                question: '22. What does your mother do after dinner? - She ... .',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207193893285781_566X320.jpg',
                options: [
                    { text: 'A. watches TV', isCorrect: false },
                    { text: 'B. washes dishes', isCorrect: true },
                    { text: 'C. reads newspaper', isCorrect: false },
                    { text: 'D. listens to music', isCorrect: false }
                ],
                correctAnswer: 'B. washes dishes',
                correctAnswer_vi: 'rửa bát đĩa',
                hint_vi: 'Nhìn vào hoạt động trong hình.',
                rationale_vi: 'Bức tranh cho thấy một người phụ nữ đang rửa bát đĩa.',
                rationale_en: 'The picture shows a woman washing dishes.'
            },
            {
                type: 'mc',
                question: '23. Tram _______ playing hide-and-seek.',
                options: [
                    { text: 'A. don’t like', isCorrect: false },
                    { text: 'B. do likes', isCorrect: false },
                    { text: 'C. doesn’t likes', isCorrect: false },
                    { text: 'D. doesn’t like', isCorrect: true }
                ],
                correctAnswer: 'D. doesn’t like',
                correctAnswer_vi: 'không thích',
                hint_vi: 'Câu phủ định với chủ ngữ ngôi thứ ba số ít.',
                rationale_vi: 'Chủ ngữ "Tram" là ngôi thứ ba số ít, nên trợ động từ phủ định là "doesn’t". Động từ theo sau "doesn’t" phải ở dạng nguyên mẫu ("like").',
                rationale_en: 'The subject "Tram" is third-person singular, so the negative auxiliary is "doesn’t". The verb following "doesn’t" must be in its base form ("like").'
            },
            {
                type: 'rearrange',
                question: '24. long/ is/ a/ It/ jump rope./',
                words: ['It', 'is', 'a', 'long', 'jump rope.'],
                correctAnswer: 'It is a long jump rope.',
                correctAnswer_vi: 'Nó là một sợi dây nhảy dài.',
                hint_vi: 'Câu miêu tả một đồ vật.',
                rationale_vi: 'Cấu trúc câu miêu tả: It + is + a/an + adj + N.',
                rationale_en: 'Descriptive sentence structure: It + is + a/an + adj + N.'
            },
            {
                type: 'mc',
                question: '25. Choose the word that has the underlined part pronounced differently from the others.',
                options: [
                    { text: 'A. P<u>u</u>pil', isCorrect: false },
                    { text: 'B. S<u>u</u>n', isCorrect: true },
                    { text: 'C. St<u>u</u>dent', isCorrect: false },
                    { text: 'D. T<u>u</u>esday', isCorrect: false }
                ],
                correctAnswer: 'B. Sun',
                correctAnswer_vi: 'Sun',
                hint_vi: 'Tìm âm /ʌ/.',
                rationale_vi: 'Chữ "u" trong "Sun" được phát âm là /ʌ/. Trong các từ còn lại, nó được phát âm là /ju:/.',
                rationale_en: 'The letter "u" in "Sun" is pronounced /ʌ/. In the other words, it is pronounced /ju:/.'
            },
            {
                type: 'rearrange',
                question: '26. red/ It/ a/ is/ ruler/',
                words: ['It', 'is', 'a', 'red', 'ruler.'],
                correctAnswer: 'It is a red ruler.',
                correctAnswer_vi: 'Nó là một cây thước màu đỏ.',
                hint_vi: 'Câu miêu tả cây thước.',
                rationale_vi: 'Cấu trúc: It + is + a/an + adj + N.',
                rationale_en: 'Structure: It + is + a/an + adj + N.'
            },
            {
                type: 'rearrange',
                question: '27. do you/ play/ badminton?/ How/ often/',
                words: ['How', 'often', 'do you', 'play', 'badminton?'],
                correctAnswer: 'How often do you play badminton?',
                correctAnswer_vi: 'Bạn có thường chơi cầu lông không?',
                hint_vi: 'Câu hỏi về mức độ thường xuyên.',
                rationale_vi: 'Cấu trúc câu hỏi với "How often": How often + do/does + S + V?',
                rationale_en: 'Question structure with "How often": How often + do/does + S + V?'
            },
            {
                type: 'fill-in-the-blank',
                question: '28. __ your house big?',
                correctAnswer: 'Is',
                correctAnswer_vi: 'Is',
                hint_vi: 'Động từ "to be" cho "your house". (2 ký tự)',
                rationale_vi: '"your house" là danh từ số ít, nên động từ "to be" ở đầu câu hỏi là "Is".',
                rationale_en: '"your house" is a singular noun, so the "to be" verb at the beginning of the question is "Is".'
            },
            {
                type: 'rearrange',
                question: '29. Open/ your/ please./ books,/',
                words: ['Open', 'your', 'books,', 'please.'],
                correctAnswer: 'Open your books, please.',
                correctAnswer_vi: 'Mở sách của các bạn ra, làm ơn.',
                hint_vi: 'Một yêu cầu trong lớp học.',
                rationale_vi: 'Đây là một câu mệnh lệnh lịch sự.',
                rationale_en: 'This is a polite imperative sentence.'
            },
            {
                type: 'multimedia',
                question: '30. Rosie, Joe, Johnny and Tony were in sch__l today.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505780807286952_Audio.mp3',
                correctAnswer: 'oo',
                correctAnswer_vi: 'oo',
                hint_vi: 'Nghe và điền nơi chốn. (2 ký tự)',
                rationale_vi: 'Bài nghe kể về các bạn nhỏ đã ở trường (school) hôm nay.',
                rationale_en: 'The audio mentions the children were at school today.'
            },
            {
                type: 'mc',
                question: '31. What are you doing? – I’m … games.',
                options: [
                    { text: 'A. saying', isCorrect: false },
                    { text: 'B. staying', isCorrect: false },
                    { text: 'C. playing', isCorrect: true },
                    { text: 'D. studying', isCorrect: false }
                ],
                correctAnswer: 'C. playing',
                correctAnswer_vi: 'chơi',
                hint_vi: 'Hành động thường làm với "games".',
                rationale_vi: 'Chúng ta "chơi" trò chơi (playing games).',
                rationale_en: 'We "play" games.'
            },
            {
                type: 'fill-in-the-blank',
                question: '32. Show me y__r pens, children.',
                correctAnswer: 'ou',
                correctAnswer_vi: 'ou',
                hint_vi: 'Tính từ sở hữu của "bạn/các bạn". (2 ký tự)',
                rationale_vi: 'Từ đúng là "your" (của bạn/của các bạn).',
                rationale_en: 'The correct word is "your".'
            },
            {
                type: 'multimedia',
                question: '33. The dog is … the table.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636162018286311844_566X320.jpg',
                options: [
                    { text: 'A. under', isCorrect: true },
                    { text: 'B. in', isCorrect: false },
                    { text: 'C. in front of', isCorrect: false },
                    { text: 'D. behind', isCorrect: false }
                ],
                correctAnswer: 'A. under',
                correctAnswer_vi: 'dưới',
                hint_vi: 'Vị trí của chú chó so với cái bàn.',
                rationale_vi: 'Trong hình, chú chó đang ở dưới cái bàn.',
                rationale_en: 'In the picture, the dog is under the table.'
            },
            {
                type: 'fill-in-the-blank',
                question: '34. Co_plete the sentences.',
                correctAnswer: 'm',
                correctAnswer_vi: 'm',
                hint_vi: 'Từ có nghĩa là "hoàn thành". (1 ký tự)',
                rationale_vi: 'Từ đúng là "Complete" (hoàn thành).',
                rationale_en: 'The correct word is "Complete".'
            },
            {
                type: 'multimedia',
                question: '35. This is Peter’s family. Look at the picture and choose the FALSE statement.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505709198154900_566X320.jpg',
                options: [
                    { text: 'A. His family is watching TV.', isCorrect: false },
                    { text: 'B. His parents are sitting on the sofa.', isCorrect: false },
                    { text: 'C. His sister is holding a bowl of popcorn.', isCorrect: true },
                    { text: 'D. He is sitting next to his sister on the floor.', isCorrect: false }
                ],
                correctAnswer: 'C. His sister is holding a bowl of popcorn.',
                correctAnswer_vi: 'Chị gái của cậu ấy đang cầm một bát bỏng ngô.',
                hint_vi: 'Tìm câu miêu tả sai sự thật trong hình.',
                rationale_vi: 'Trong hình, cậu bé (Peter/He) mới là người cầm bát bỏng ngô, không phải chị gái. Vì vậy, câu C là câu sai.',
                rationale_en: 'In the picture, the boy (Peter/He) is the one holding the bowl of popcorn, not his sister. Therefore, statement C is false.'
            },
            {
                type: 'mc',
                question: '36. Odd one out:',
                options: [
                    { text: 'A. sing', isCorrect: true },
                    { text: 'B. subjects', isCorrect: false },
                    { text: 'C. animal', isCorrect: false },
                    { text: 'D. bike', isCorrect: false }
                ],
                correctAnswer: 'A. sing',
                correctAnswer_vi: 'hát',
                hint_vi: 'Tìm từ là động từ.',
                rationale_vi: '"subjects", "animal", "bike" là các danh từ. "sing" là một động từ.',
                rationale_en: '"subjects", "animal", "bike" are nouns. "sing" is a verb.'
            },
            {
                type: 'rearrange',
                question: '37. the table./ on/ are/ pencils/ His/',
                words: ['His', 'pencils', 'are', 'on', 'the table.'],
                correctAnswer: 'His pencils are on the table.',
                correctAnswer_vi: 'Những cây bút chì của cậu ấy ở trên bàn.',
                hint_vi: 'Câu miêu tả vị trí đồ vật.',
                rationale_vi: 'Chủ ngữ số nhiều (His pencils) + are + cụm giới từ chỉ nơi chốn (on the table).',
                rationale_en: 'Plural subject (His pencils) + are + prepositional phrase of place (on the table).'
            },
            {
                type: 'fill-in-the-blank',
                question: '38. This doll is for you. - Thank you very m___.',
                correctAnswer: 'uch',
                correctAnswer_vi: 'uch',
                hint_vi: 'Cụm từ "cảm ơn rất nhiều". (3 ký tự)',
                rationale_vi: 'Cụm từ "Thank you very much" có nghĩa là "Cảm ơn bạn rất nhiều".',
                rationale_en: 'The phrase "Thank you very much" means "Thanks a lot".'
            },
            {
                type: 'mc',
                question: '39. How many tomatoes … in the basket?',
                options: [
                    { text: 'A. is there', isCorrect: false },
                    { text: 'B. are these', isCorrect: false },
                    { text: 'C. is this', isCorrect: false },
                    { text: 'D. are there', isCorrect: true }
                ],
                correctAnswer: 'D. are there',
                correctAnswer_vi: 'có',
                hint_vi: 'Cấu trúc "How many" đi với "are there".',
                rationale_vi: 'Sau "How many + danh từ số nhiều" (tomatoes), chúng ta dùng cấu trúc "are there" để hỏi về số lượng.',
                rationale_en: 'After "How many + plural noun" (tomatoes), we use the structure "are there" to ask about quantity.'
            },
            {
                type: 'rearrange',
                question: '40. has/ Fridays./ brother/ My/ P.E on/',
                words: ['My', 'brother', 'has', 'P.E', 'on', 'Fridays.'],
                correctAnswer: 'My brother has P.E on Fridays.',
                correctAnswer_vi: 'Anh trai tôi có môn Thể dục vào các ngày thứ Sáu.',
                hint_vi: 'Câu nói về lịch học.',
                rationale_vi: 'Cấu trúc: S + has + O + on + Wdays.',
                rationale_en: 'Structure: S + has + O + on + Wdays.'
            },
            {
                type: 'rearrange',
                question: '41. in/ I/ Hanoi/ am/ now./',
                words: ['I', 'am', 'in', 'Hanoi', 'now.'],
                correctAnswer: 'I am in Hanoi now.',
                correctAnswer_vi: 'Bây giờ tôi đang ở Hà Nội.',
                hint_vi: 'Câu nói về vị trí hiện tại.',
                rationale_vi: 'Cấu trúc: S + am/is/are + cụm từ chỉ nơi chốn.',
                rationale_en: 'Structure: S + am/is/are + prepositional phrase of place.'
            },
            {
                type: 'fill-in-the-blank',
                question: '42. Che__k the words you hear.',
                correctAnswer: 'c',
                correctAnswer_vi: 'c',
                hint_vi: 'Từ có nghĩa là "kiểm tra". (1 ký tự)',
                rationale_vi: 'Từ đúng là "Check" (kiểm tra).',
                rationale_en: 'The correct word is "Check".'
            },
            {
                type: 'fill-in-the-blank',
                question: '43. My school is in Nguyen Trai Str__t.',
                correctAnswer: 'ee',
                correctAnswer_vi: 'ee',
                hint_vi: 'Từ có nghĩa là "đường phố". (2 ký tự)',
                rationale_vi: 'Từ đúng là "Street" (đường phố).',
                rationale_en: 'The correct word is "Street".'
            },
            {
                type: 'fill-in-the-blank',
                question: '44. Would you like an apple?- No, t____s.',
                correctAnswer: 'hank',
                correctAnswer_vi: 'hank',
                hint_vi: 'Cách từ chối lịch sự. (4 ký tự)',
                rationale_vi: 'Cụm từ "No, thanks" dùng để từ chối một lời đề nghị một cách lịch sự.',
                rationale_en: 'The phrase "No, thanks" is used to politely decline an offer.'
            },
            {
                type: 'rearrange',
                question: '45. on Sundays./ He/ go/ doesn\'t/ to school/',
                words: ['He', 'doesn\'t', 'go', 'to school', 'on Sundays.'],
                correctAnswer: 'He doesn\'t go to school on Sundays.',
                correctAnswer_vi: 'Anh ấy không đến trường vào các ngày Chủ nhật.',
                hint_vi: 'Câu phủ định ở thì hiện tại đơn.',
                rationale_vi: 'Cấu trúc câu phủ định: S + doesn\'t + V(nguyên mẫu) + ...',
                rationale_en: 'Negative sentence structure: S + doesn\'t + V(infinitive) + ...'
            },
            {
                type: 'fill-in-the-blank',
                question: '46. He h__ many toys.',
                correctAnswer: 'as',
                correctAnswer_vi: 'as',
                hint_vi: 'Động từ "có" cho ngôi "He". (2 ký tự)',
                rationale_vi: 'Động từ "have" khi đi với chủ ngữ ngôi thứ ba số ít (He, She, It) sẽ biến thành "has".',
                rationale_en: 'The verb "have" becomes "has" when used with a third-person singular subject (He, She, It).'
            },
            {
                type: 'fill-in-the-blank',
                question: '47. This is my r__m.',
                correctAnswer: 'oo',
                correctAnswer_vi: 'oo',
                hint_vi: 'Từ có nghĩa là "căn phòng". (2 ký tự)',
                rationale_vi: 'Từ đúng là "room" (căn phòng).',
                rationale_en: 'The correct word is "room".'
            },
            {
                type: 'multimedia',
                question: '48. What subjects have they got on Monday?',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505710296756649_Audio.mp3',
                options: [
                    { text: 'A. Maths and Science.', isCorrect: false },
                    { text: 'B. Music and English.', isCorrect: false },
                    { text: 'C. English and Maths.', isCorrect: true },
                    { text: 'D. Science and Music.', isCorrect: false }
                ],
                correctAnswer: 'C. English and Maths.',
                correctAnswer_vi: 'Tiếng Anh và Toán.',
                hint_vi: 'Nghe và xác định các môn học.',
                rationale_vi: 'Bài nghe nói rằng vào thứ Hai, họ có môn Tiếng Anh và môn Toán.',
                rationale_en: 'The audio says that on Monday, they have English and Maths.'
            },
            {
                type: 'multimedia',
                question: '49. SHE HAS A LOT OF FUN ON _____.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D3_4.mp3',
                correctAnswer: 'saturday',
                correctAnswer_vi: 'saturday',
                hint_vi: 'Nghe và điền tên ngày trong tuần. (8 ký tự)',
                rationale_vi: 'Bài nghe nói "She has a lot of fun on saturday" (Cô ấy có rất nhiều niềm vui vào thứ bảy).',
                rationale_en: 'The audio says "She has a lot of fun on saturday".'
            },
            {
                type: 'rearrange',
                question: '50. are/ two books/ on/ the table./ There/',
                words: ['There', 'are', 'two books', 'on', 'the table.'],
                correctAnswer: 'There are two books on the table.',
                correctAnswer_vi: 'Có hai quyển sách trên bàn.',
                hint_vi: 'Bắt đầu với "There are".',
                rationale_vi: 'Cấu trúc "There are" + danh từ số nhiều + cụm từ chỉ nơi chốn.',
                rationale_en: 'Structure: "There are" + plural noun + prepositional phrase of place.'
            },
            {
                type: 'mc',
                question: '51. Count the ... in the picture.',
                options: [
                    { text: 'A. books', isCorrect: true },
                    { text: 'B. boy', isCorrect: false },
                    { text: 'C. pencil', isCorrect: false },
                    { text: 'D. girl', isCorrect: false }
                ],
                correctAnswer: 'A. books',
                correctAnswer_vi: 'những quyển sách',
                hint_vi: 'Động từ "count" (đếm) thường đi với danh từ đếm được số nhiều.',
                rationale_vi: 'Trong các lựa chọn, "books" là danh từ số nhiều duy nhất hợp lý để đi với động từ "count" trong ngữ cảnh chung.',
                rationale_en: 'Among the options, "books" is the only plural noun that logically follows the verb "count" in a general context.'
            },
            {
                type: 'multimedia',
                question: '52. Tom has ____ on Monday.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790911641856700_Audio.mp3',
                correctAnswer: 'Maths',
                correctAnswer_vi: 'môn Toán',
                hint_vi: 'Nghe và điền tên môn học. (5 ký tự)',
                rationale_vi: 'Bài nghe nói về lịch học của Tom, trong đó có môn Toán (Maths) vào thứ Hai.',
                rationale_en: 'The audio talks about Tom\'s schedule, which includes Maths on Monday.'
            },
            {
                type: 'rearrange',
                question: '53. are/ your school bag?/ many pens/ How/ there in/',
                words: ['How', 'many pens', 'are there in', 'your school bag?'],
                correctAnswer: 'How many pens are there in your school bag?',
                correctAnswer_vi: 'Có bao nhiêu cây bút trong cặp sách của bạn?',
                hint_vi: 'Câu hỏi với "How many".',
                rationale_vi: 'Cấu trúc: How many + N(số nhiều) + are there + ...?',
                rationale_en: 'Structure: How many + N(plural) + are there + ...?'
            },
            {
                type: 'fill-in-the-blank',
                question: '54. I’d like __ ice-cream.',
                correctAnswer: 'an',
                correctAnswer_vi: 'an',
                hint_vi: 'Mạo từ đứng trước nguyên âm. (2 ký tự)',
                rationale_vi: '"ice-cream" bắt đầu bằng một nguyên âm ("i"), vì vậy chúng ta dùng mạo từ "an".',
                rationale_en: '"ice-cream" starts with a vowel sound ("i"), so we use the article "an".'
            },
            {
                type: 'rearrange',
                question: '55. do you/ many/ How/ pets/ have?/',
                words: ['How', 'many', 'pets', 'do you', 'have?'],
                correctAnswer: 'How many pets do you have?',
                correctAnswer_vi: 'Bạn có bao nhiêu thú cưng?',
                hint_vi: 'Câu hỏi số lượng với động từ thường.',
                rationale_vi: 'Cấu trúc: How many + N(số nhiều) + do/does + S + have?',
                rationale_en: 'Structure: How many + N(plural) + do/does + S + have?'
            },
            {
                type: 'fill-in-the-blank',
                question: '56. I’d ___e an apple, please.',
                correctAnswer: 'lik',
                correctAnswer_vi: 'lik',
                hint_vi: 'Cụm từ "I would like...". (3 ký tự)',
                rationale_vi: 'Cấu trúc "I would like" (viết tắt I\'d like) dùng để diễn tả mong muốn một cách lịch sự.',
                rationale_en: 'The structure "I would like" (shortened to I\'d like) is used to express a desire politely.'
            },
            {
                type: 'mc',
                question: '57. Choose the odd one out:',
                options: [
                    { text: 'A. pen', isCorrect: false },
                    { text: 'B. notebook', isCorrect: false },
                    { text: 'C. sing', isCorrect: true },
                    { text: 'D. ruler', isCorrect: false }
                ],
                correctAnswer: 'C. sing',
                correctAnswer_vi: 'hát',
                hint_vi: 'Tìm từ không phải là đồ dùng học tập.',
                rationale_vi: '"pen", "notebook", "ruler" là các đồ dùng học tập (danh từ). "sing" là một hành động (động từ).',
                rationale_en: '"pen", "notebook", "ruler" are school supplies (nouns). "sing" is an action (verb).'
            },
            {
                type: 'fill-in-the-blank',
                question: '58. It is a big school __ Hai Ba Trung Street.',
                correctAnswer: 'on',
                correctAnswer_vi: 'on',
                hint_vi: 'Giới từ đi với tên đường. (2 ký tự)',
                rationale_vi: 'Chúng ta dùng giới từ "on" trước tên một con đường.',
                rationale_en: 'We use the preposition "on" before the name of a street.'
            },
            {
                type: 'mc',
                question: '59. How are you? – ...',
                options: [
                    { text: 'A. I’m nice.', isCorrect: false },
                    { text: 'B. I’m happy.', isCorrect: false },
                    { text: 'C. I’m fine, thanks.', isCorrect: true },
                    { text: 'D. I’m good, thanks.', isCorrect: false }
                ],
                correctAnswer: 'C. I’m fine, thanks.',
                correctAnswer_vi: 'Tôi khỏe, cảm ơn.',
                hint_vi: 'Chọn câu trả lời thông dụng và đầy đủ nhất.',
                rationale_vi: '"I’m fine, thanks." là câu trả lời chuẩn mực và phổ biến nhất cho câu hỏi "How are you?".',
                rationale_en: '"I’m fine, thanks." is the most standard and common response to the question "How are you?".'
            },
            {
                type: 'rearrange',
                question: '60. What/ your/ nationality is/ grandfather?/',
                words: ['What', 'is your', 'grandfather\'s', 'nationality?'],
                correctAnswer: 'What is your grandfather\'s nationality?',
                correctAnswer_vi: 'Quốc tịch của ông bạn là gì?',
                hint_vi: 'Câu hỏi về quốc tịch.',
                rationale_vi: 'Cấu trúc: What + is + sở hữu cách + nationality?',
                rationale_en: 'Structure: What + is + possessive + nationality?'
            },
            {
                type: 'fill-in-the-blank',
                question: '61. Is he strong or ____?',
                correctAnswer: 'weak',
                correctAnswer_vi: 'yếu',
                hint_vi: 'Từ trái nghĩa với "strong". (4 ký tự)',
                rationale_vi: 'Từ "weak" (yếu) là từ trái nghĩa với "strong" (khỏe).',
                rationale_en: 'The word "weak" is the opposite of "strong".'
            },
            {
                type: 'fill-in-the-blank',
                question: '62. I was born in Dec__ber.',
                correctAnswer: 'em',
                correctAnswer_vi: 'em',
                hint_vi: 'Tên của tháng Mười Hai. (2 ký tự)',
                rationale_vi: 'Từ đúng là "December" (Tháng Mười Hai).',
                rationale_en: 'The correct word is "December".'
            },
            {
                type: 'multimedia',
                question: '63. I’m ... years old.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206416027745225_Audio.mp3',
                options: [
                    { text: 'A. tenth', isCorrect: false },
                    { text: 'B. ten', isCorrect: true },
                    { text: 'C. tent', isCorrect: false },
                    { text: 'D. tell', isCorrect: false }
                ],
                correctAnswer: 'B. ten',
                correctAnswer_vi: 'mười',
                hint_vi: 'Nghe và chọn số tuổi.',
                rationale_vi: 'Bài nghe nói "I\'m ten years old" (Tôi mười tuổi).',
                rationale_en: 'The audio says "I\'m ten years old".'
            },
            {
                type: 'rearrange',
                question: '64. for/ This/ is/ you./ doll/',
                words: ['This', 'doll', 'is', 'for', 'you.'],
                correctAnswer: 'This doll is for you.',
                correctAnswer_vi: 'Búp bê này dành cho bạn.',
                hint_vi: 'Câu nói khi tặng quà.',
                rationale_vi: 'Cấu trúc câu: S (This doll) + V (is) + for you.',
                rationale_en: 'Sentence structure: S (This doll) + V (is) + for you.'
            },
            {
                type: 'fill-in-the-blank',
                question: '65. H__ is the weather today? – It’s cool today.',
                correctAnswer: 'ow',
                correctAnswer_vi: 'ow',
                hint_vi: 'Câu hỏi về thời tiết. (2 ký tự)',
                rationale_vi: 'Cụm từ "How is the weather?" dùng để hỏi về thời tiết.',
                rationale_en: 'The phrase "How is the weather?" is used to ask about the weather.'
            },
            {
                type: 'mc',
                question: '66. Choose the odd one out:',
                options: [
                    { text: 'A. windy', isCorrect: false },
                    { text: 'B. sunny', isCorrect: false },
                    { text: 'C. cloud', isCorrect: true },
                    { text: 'D. cloudy', isCorrect: false }
                ],
                correctAnswer: 'C. cloud',
                correctAnswer_vi: 'đám mây',
                hint_vi: 'Tìm từ là danh từ.',
                rationale_vi: '"windy", "sunny", "cloudy" là các tính từ chỉ thời tiết. "cloud" là một danh từ.',
                rationale_en: '"windy", "sunny", "cloudy" are adjectives describing weather. "cloud" is a noun.'
            },
            {
                type: 'mc',
                question: '67. Choose the odd one out:',
                options: [
                    { text: 'A. teddy bear', isCorrect: false },
                    { text: 'B. doll', isCorrect: false },
                    { text: 'C. robot', isCorrect: false },
                    { text: 'D. parrot', isCorrect: true }
                ],
                correctAnswer: 'D. parrot',
                correctAnswer_vi: 'con vẹt',
                hint_vi: 'Tìm từ không phải là đồ chơi.',
                rationale_vi: '"teddy bear", "doll", "robot" là các loại đồ chơi. "parrot" là một con vật.',
                rationale_en: '"teddy bear", "doll", "robot" are types of toys. "parrot" is an animal.'
            },
            {
                type: 'mc',
                question: '68. Choose the word that has the underlined part pronounced differently from the others.',
                options: [
                    { text: 'A. Pian<u>o</u>', isCorrect: false },
                    { text: 'B. N<u>o</u>', isCorrect: false },
                    { text: 'C. G<u>o</u>', isCorrect: false },
                    { text: 'D. Vi<u>o</u>lin', isCorrect: true }
                ],
                correctAnswer: 'D. Violin',
                correctAnswer_vi: 'Violin',
                hint_vi: 'Tìm âm /ə/ hoặc /ɪ/ khác với /oʊ/.',
                rationale_vi: 'Chữ "o" trong "Piano", "No", "Go" được phát âm là /oʊ/. Chữ "o" trong "Violin" được phát âm là /ə/ (âm schwa) do không được nhấn trọng âm.',
                rationale_en: 'The "o" sound in "Piano", "No", "Go" is pronounced /oʊ/. The "o" sound in "Violin" is pronounced /ə/ (schwa) because it is unstressed.'
            },
            {
                type: 'fill-in-the-blank',
                question: '69. My sister’s room is l_rge.',
                correctAnswer: 'a',
                correctAnswer_vi: 'a',
                hint_vi: 'Từ có nghĩa là "rộng, lớn". (1 ký tự)',
                rationale_vi: 'Từ đúng là "large" (rộng, lớn).',
                rationale_en: 'The correct word is "large".'
            },
            {
                type: 'fill-in-the-blank',
                question: '70. My working day is from Monday to F_____.',
                correctAnswer: 'riday',
                correctAnswer_vi: 'riday',
                hint_vi: 'Thứ Sáu. (5 ký tự)',
                rationale_vi: 'Từ đúng là "Friday" (Thứ Sáu).',
                rationale_en: 'The correct word is "Friday".'
            },
            {
                type: 'multimedia',
                question: '71. Bic___e',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/27/637104527620921462_566X320.jpg',
                correctAnswer: 'ycl',
                correctAnswer_vi: 'ycl',
                hint_vi: 'Từ có nghĩa là "xe đạp". (3 ký tự)',
                rationale_vi: 'Từ đúng là "BICYCLE" (xe đạp).',
                rationale_en: 'The correct word is "BICYCLE".'
            },
            {
                type: 'mc',
                question: '72. Would you like … cup of coffee, Anne?',
                options: [
                    { text: 'A. a', isCorrect: true },
                    { text: 'B. an', isCorrect: false },
                    { text: 'C. some', isCorrect: false },
                    { text: 'D. any', isCorrect: false }
                ],
                correctAnswer: 'A. a',
                correctAnswer_vi: 'một',
                hint_vi: 'Mạo từ cho danh từ đếm được số ít.',
                rationale_vi: '"cup" là danh từ đếm được số ít và bắt đầu bằng phụ âm, vì vậy dùng mạo từ "a".',
                rationale_en: '"cup" is a singular countable noun starting with a consonant, so the article "a" is used.'
            },
            {
                type: 'mc',
                question: '73. What … is that? – It’s an octopus.',
                options: [
                    { text: 'A. holiday', isCorrect: false },
                    { text: 'B. subject', isCorrect: false },
                    { text: 'C. sport', isCorrect: false },
                    { text: 'D. animal', isCorrect: true }
                ],
                correctAnswer: 'D. animal',
                correctAnswer_vi: 'con vật',
                hint_vi: 'Bạch tuộc là một loại...',
                rationale_vi: 'An octopus (bạch tuộc) là một con vật (animal).',
                rationale_en: 'An octopus is an animal.'
            },
            {
                type: 'multimedia',
                question: '74. She is my ... .',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206445203200607_Audio.mp3',
                options: [
                    { text: 'A. mother', isCorrect: mother },
                    { text: 'B. teacher', isCorrect: false },
                    { text: 'C. sister', isCorrect: false },
                    { text: 'D. father', isCorrect: false }
                ],
                correctAnswer: 'A. mother',
                correctAnswer_vi: 'mẹ',
                hint_vi: 'Nghe và xác định mối quan hệ.',
                rationale_vi: 'Bài nghe nói "She is my mother" (Cô ấy là mẹ của tôi).',
                rationale_en: 'The audio says "She is my sister".'
            },
            {
                type: 'fill-in-the-blank',
                question: '75. ____ time do you go to bed?',
                correctAnswer: 'What',
                correctAnswer_vi: 'What',
                hint_vi: 'Câu hỏi về thời gian. (4 ký tự)',
                rationale_vi: 'Cấu trúc "What time...?" dùng để hỏi về giờ giấc cụ thể.',
                rationale_en: 'The structure "What time...?" is used to ask for a specific time.'
            },
            {
                type: 'multimedia',
                question: '76. His birthday is in ... .',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206434399480946_Audio.mp3',
                options: [
                    { text: 'A. June', isCorrect: false },
                    { text: 'B. July', isCorrect: true },
                    { text: 'C. Judy', isCorrect: false },
                    { text: 'D. Jack', isCorrect: false }
                ],
                correctAnswer: 'B. July',
                correctAnswer_vi: 'tháng Bảy',
                hint_vi: 'Nghe và chọn tháng.',
                rationale_vi: 'Bài nghe nói "His birthday is in July" (Sinh nhật của cậu ấy vào tháng Bảy).',
                rationale_en: 'The audio says "His birthday is in July".'
            },
            {
                type: 'mc',
                question: '77. Tom can speak ... .',
                options: [
                    { text: 'A. Vietnam', isCorrect: false },
                    { text: 'B. England', isCorrect: false },
                    { text: 'C. Vietnamese', isCorrect: true },
                    { text: 'D. America', isCorrect: false }
                ],
                correctAnswer: 'C. Vietnamese',
                correctAnswer_vi: 'Tiếng Việt',
                hint_vi: 'Chọn một ngôn ngữ.',
                rationale_vi: 'Sau động từ "speak" là một ngôn ngữ. "Vietnamese" là tiếng Việt. Các lựa chọn khác là tên quốc gia.',
                rationale_en: 'After the verb "speak" comes a language. "Vietnamese" is the Vietnamese language. The other options are country names.'
            },
            {
                type: 'mc',
                question: '78. What is ... father’s job?',
                options: [
                    { text: 'A. you', isCorrect: false },
                    { text: 'B. yours', isCorrect: false },
                    { text: 'C. your’s', isCorrect: false },
                    { text: 'D. your', isCorrect: true }
                ],
                correctAnswer: 'D. your',
                correctAnswer_vi: 'của bạn',
                hint_vi: 'Tính từ sở hữu.',
                rationale_vi: '"your" là tính từ sở hữu đứng trước danh từ "father". "your’s" là cách viết sai.',
                rationale_en: '"your" is the possessive adjective that comes before the noun "father". "your’s" is incorrect spelling.'
            },
            {
                type: 'multimedia',
                question: '79. Spiders hear by using _____ on their legs.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790677842651515_Audio.mp3',
                correctAnswer: 'hairs',
                correctAnswer_vi: 'lông',
                hint_vi: 'Nghe và điền bộ phận cơ thể. (5 ký tự)',
                rationale_vi: 'Bài nghe giải thích rằng nhện nghe bằng những sợi lông (hairs) trên chân của chúng.',
                rationale_en: 'The audio explains that spiders hear by using hairs on their legs.'
            },
            {
                type: 'rearrange',
                question: '80. My father/ playing baseball/ does, too./ and my brother/ likes/',
                words: ['My father', 'likes', 'playing baseball', 'and my brother', 'does, too.'],
                correctAnswer: 'My father likes playing baseball and my brother does, too.',
                correctAnswer_vi: 'Bố tôi thích chơi bóng chày và anh trai tôi cũng vậy.',
                hint_vi: 'Cấu trúc đồng tình khẳng định.',
                rationale_vi: 'S + V, and S + do/does, too.',
                rationale_en: 'S + V, and S + do/does, too.'
            },
            {
                type: 'mc',
                question: '81. ... go to the school library. – That’s a good idea.',
                options: [
                    { text: 'A. How', isCorrect: false },
                    { text: 'B. Can', isCorrect: false },
                    { text: 'C. Do', isCorrect: false },
                    { text: 'D. Let’s', isCorrect: true }
                ],
                correctAnswer: 'D. Let’s',
                correctAnswer_vi: 'Chúng ta hãy',
                hint_vi: 'Cấu trúc câu rủ rê, gợi ý.',
                rationale_vi: 'Cấu trúc "Let’s + V(nguyên mẫu)" dùng để đưa ra lời gợi ý, rủ ai đó cùng làm gì. Câu trả lời "That’s a good idea" (Đó là một ý kiến hay) xác nhận điều này.',
                rationale_en: 'The structure "Let’s + V(infinitive)" is used to make a suggestion. The response "That’s a good idea" confirms this.'
            },
            {
                type: 'multimedia',
                question: '82. Listen and tick:',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206409407725957_Audio.mp3',
                options: [
                    { text: 'A. He can speak English.', isCorrect: true },
                    { text: 'B. He can’t speak English.', isCorrect: false },
                    { text: 'C. She can speak English.', isCorrect: false },
                    { text: 'D. She can’t speak English.', isCorrect: false }
                ],
                correctAnswer: 'A. He can speak English.',
                correctAnswer_vi: 'Anh ấy có thể nói tiếng Anh.',
                hint_vi: 'Nghe kỹ câu được nói.',
                rationale_vi: 'Đoạn audio nói: "He can speak English".',
                rationale_en: 'The audio says: "He can speak English".'
            },
            {
                type: 'mc',
                question: '83. Today is ______.',
                options: [
                    { text: 'A. monday', isCorrect: false },
                    { text: 'B. the twenty-four of february', isCorrect: false },
                    { text: 'C. the seventeenth of May', isCorrect: true },
                    { text: 'D. first the July', isCorrect: false }
                ],
                correctAnswer: 'C. the seventeenth of May',
                correctAnswer_vi: 'ngày 17 tháng 5',
                hint_vi: 'Chọn cách viết ngày tháng đúng ngữ pháp và chính tả.',
                rationale_vi: 'Câu C là cách viết đúng nhất. Câu A sai vì không viết hoa. Câu B sai chính tả "february". Câu D sai trật tự từ.',
                rationale_en: 'Option C is the most correct way to write a date. A is wrong because it\'s not capitalized. B has a spelling error. D has the wrong word order.'
            },
            {
                type: 'multimedia',
                question: '84. I have ___ books.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790677578900928_Audio.mp3',
                correctAnswer: 'six',
                correctAnswer_vi: 'sáu',
                hint_vi: 'Nghe và điền số lượng. (3 ký tự)',
                rationale_vi: 'Bài nghe nói "I have six books" (Tôi có sáu quyển sách).',
                rationale_en: 'The audio says "I have six books".'
            },
            {
                type: 'fill-in-the-blank',
                question: '85. I am f_rom Singapore.',
                correctAnswer: 'r',
                correctAnswer_vi: 'r',
                hint_vi: 'Từ có nghĩa là "đến từ". (1 ký tự)',
                rationale_vi: 'Cụm từ "from Singapore" có nghĩa là đến từ Singapore.',
                rationale_en: 'The phrase "from Singapore" means originating in Singapore.'
            },
            {
                type: 'rearrange',
                question: '86. I/ Hello,/ am/ Andy./',
                words: ['Hello,', 'I', 'am', 'Andy.'],
                correctAnswer: 'Hello, I am Andy.',
                correctAnswer_vi: 'Xin chào, tôi là Andy.',
                hint_vi: 'Một câu tự giới thiệu.',
                rationale_vi: 'Đây là cách tự giới thiệu tên phổ biến.',
                rationale_en: 'This is a common way to introduce oneself.'
            },
            {
                type: 'multimedia',
                question: '87. Tom’s from _______.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790679070814804_Audio.mp3',
                correctAnswer: 'America',
                correctAnswer_vi: 'nước Mỹ',
                hint_vi: 'Nghe và điền tên quốc gia. (7 ký tự)',
                rationale_vi: 'Bài nghe nói "Tom’s from America" (Tom đến từ nước Mỹ).',
                rationale_en: 'The audio says "Tom’s from America".'
            },
            {
                type: 'rearrange',
                question: '88. Is Sarah’s/ of/ birthday/ October?/ on the first/',
                words: ['Is Sarah’s', 'birthday', 'on the first', 'of', 'October?'],
                correctAnswer: 'Is Sarah’s birthday on the first of October?',
                correctAnswer_vi: 'Sinh nhật của Sarah có phải vào ngày 1 tháng 10 không?',
                hint_vi: 'Câu hỏi về ngày sinh nhật.',
                rationale_vi: 'Cấu trúc câu hỏi Yes/No về ngày cụ thể: Is... on + the + số thứ tự + of + tháng?',
                rationale_en: 'Yes/No question structure for a specific date: Is... on + the + ordinal number + of + month?'
            },
            {
                type: 'rearrange',
                question: '89. the amusement/ Let’s/ park./ go to/',
                words: ['Let’s', 'go to', 'the amusement', 'park.'],
                correctAnswer: 'Let’s go to the amusement park.',
                correctAnswer_vi: 'Chúng ta hãy đến công viên giải trí.',
                hint_vi: 'Một lời rủ rê.',
                rationale_vi: 'Cấu trúc "Let\'s + V(nguyên mẫu)" dùng để gợi ý, rủ rê.',
                rationale_en: 'The structure "Let\'s + V(infinitive)" is used to make a suggestion.'
            },
            {
                type: 'mc',
                question: '90. Are you ______ a dictation?',
                options: [
                    { text: 'A. playing', isCorrect: false },
                    { text: 'B. writing', isCorrect: true },
                    { text: 'C. watching', isCorrect: false },
                    { text: 'D. singing', isCorrect: false }
                ],
                correctAnswer: 'B. writing',
                correctAnswer_vi: 'viết',
                hint_vi: 'Hành động làm với bài chính tả.',
                rationale_vi: 'Chúng ta "viết" một bài chính tả (writing a dictation).',
                rationale_en: 'We "write" a dictation.'
            },
            {
                type: 'rearrange',
                question: '91. a cup/ Does/ want/ Minh/ of tea?/',
                words: ['Does', 'Minh', 'want', 'a cup', 'of tea?'],
                correctAnswer: 'Does Minh want a cup of tea?',
                correctAnswer_vi: 'Minh có muốn một tách trà không?',
                hint_vi: 'Câu hỏi Yes/No.',
                rationale_vi: 'Cấu trúc: Does + S + want + ...?',
                rationale_en: 'Structure: Does + S + want + ...?'
            },
            {
                type: 'rearrange',
                question: '92. much./ fast food/ likes/ My brother/ very/',
                words: ['My brother', 'likes', 'fast food', 'very', 'much.'],
                correctAnswer: 'My brother likes fast food very much.',
                correctAnswer_vi: 'Anh trai tôi rất thích đồ ăn nhanh.',
                hint_vi: '"very much" đứng ở cuối câu.',
                rationale_vi: 'Cấu trúc: S + likes + O + very much.',
                rationale_en: 'Structure: S + likes + O + very much.'
            },
            {
                type: 'multimedia',
                question: '93. My father is helping me m___ a kite.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505771132361665_566X320.jpg',
                correctAnswer: 'ake',
                correctAnswer_vi: 'ake',
                hint_vi: 'Từ có nghĩa là "làm". (3 ký tự)',
                rationale_vi: 'Cụm từ "make a kite" có nghĩa là làm một con diều.',
                rationale_en: 'The phrase "make a kite" means to construct a kite.'
            },
            {
                type: 'rearrange',
                question: '94. is your/ What class/ sister in? – She/ class 4B./ is in/',
                words: ['What class', 'is your', 'sister in?', 'She', 'is in', 'class 4B.'],
                correctAnswer: 'What class is your sister in? She is in class 4B.',
                correctAnswer_vi: 'Chị gái của bạn học lớp nào? Chị ấy học lớp 4B.',
                hint_vi: 'Một đoạn hội thoại ngắn.',
                rationale_vi: 'Đây là câu hỏi và câu trả lời về lớp học của một người.',
                rationale_en: 'This is a question and answer about someone\'s class.'
            },
            {
                type: 'mc',
                question: '95. Choose the odd one out:',
                options: [
                    { text: 'A. sing', isCorrect: true },
                    { text: 'B. kite', isCorrect: false },
                    { text: 'C. animal', isCorrect: false },
                    { text: 'D. tree', isCorrect: false }
                ],
                correctAnswer: 'A. sing',
                correctAnswer_vi: 'hát',
                hint_vi: 'Tìm từ là động từ.',
                rationale_vi: '"kite", "animal", "tree" là các danh từ. "sing" là một động từ.',
                rationale_en: '"kite", "animal", "tree" are nouns. "sing" is a verb.'
            },
            {
                type: 'fill-in-the-blank',
                question: '96. My books are on the ta__e.',
                correctAnswer: 'bl',
                correctAnswer_vi: 'bl',
                hint_vi: 'Từ có nghĩa là "cái bàn". (2 ký tự)',
                rationale_vi: 'Từ đúng là "table" (cái bàn).',
                rationale_en: 'The correct word is "table".'
            },
            {
                type: 'rearrange',
                question: '97. in a/ She/ school./ small/ works/',
                words: ['She', 'works', 'in a', 'small', 'school.'],
                correctAnswer: 'She works in a small school.',
                correctAnswer_vi: 'Cô ấy làm việc trong một ngôi trường nhỏ.',
                hint_vi: 'Câu miêu tả công việc.',
                rationale_vi: 'Cấu trúc câu: S + V-s/es + cụm từ chỉ nơi chốn.',
                rationale_en: 'Sentence structure: S + V-s/es + prepositional phrase of place.'
            },
            {
                type: 'fill-in-the-blank',
                question: '98. MORNIN_',
                correctAnswer: 'G',
                correctAnswer_vi: 'G',
                hint_vi: 'Từ có nghĩa là "buổi sáng". (1 ký tự)',
                rationale_vi: 'Từ đúng là "MORNING".',
                rationale_en: 'The correct word is "MORNING".'
            },
            {
                type: 'multimedia',
                question: '99. Linh has ___ on Fridays.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D2_28.jpg',
                options: [
                    { text: 'A. Music', isCorrect: false },
                    { text: 'B. Art', isCorrect: false },
                    { text: 'C. Maths', isCorrect: false },
                    { text: 'D. P.E', isCorrect: true }
                ],
                correctAnswer: 'D. P.E',
                correctAnswer_vi: 'thể dục',
                hint_vi: 'Nhìn vào hình.',
                rationale_vi: ' Linh có môn thể dục.',
                rationale_en: 'According to the picture, Linh has P.E.'
            },
            {
                type: 'rearrange',
                question: '100. Where/ does/ Sam/ live?/',
                words: ['Where', 'does', 'Sam', 'live?'],
                correctAnswer: 'Where does Sam live?',
                correctAnswer_vi: 'Sam sống ở đâu?',
                hint_vi: 'Câu hỏi về nơi ở.',
                rationale_vi: 'Cấu trúc câu hỏi với "Where": Where + do/does + S + live?',
                rationale_en: 'Question structure with "Where": Where + do/does + S + live?'
            }
        ];
        
        // --- Component: MediaDisplay (Helper for Image/Audio rendering) ---
        const MediaDisplay = ({ question, showMessage }) => {
            if (question.mediaType === 'image') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🖼️ Nhìn hình và trả lời</p>
                        <img 
                            src={question.mediaSource}
                            alt={`Hình ảnh IOE: ${question.imagePrompt || 'Chủ đề câu hỏi'}`} 
                            className="w-full max-w-xs mx-auto rounded-lg shadow-md border-2 border-gray-300"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={(e) => { 
                                e.target.onerror = null; 
                                e.target.src = `https://placehold.co/566x320/FF0000/FFFFFF?text=L%E1%BB%97I+T%E1%BA%A2I+%E1%BA%A2NH+(CORS)`; 
                                showMessage('Lỗi tải ảnh: File media có thể bị chặn bởi trình duyệt.', 'error');
                            }}
                        />
                        <p className="text-xs text-gray-500 mt-2 break-all">Link gốc: {question.mediaSource}</p>
                        {question.imagePrompt && <p className="text-sm text-blue-600 mt-2 font-medium">Gợi ý nội dung: {question.imagePrompt}</p>}
                    </div>
                );
            }

            if (question.mediaType === 'audio') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🔊 Nghe và trả lời (Bấm Play)</p>
                        <audio 
                            controls
                            src={question.mediaSource}
                            className="w-full max-w-sm mx-auto my-2"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={() => {
                                showMessage('Lỗi tải Audio: File media có thể bị chặn.', 'error');
                            }}
                        >
                            <source src={question.mediaSource} type="audio/mp3" />
                            Trình duyệt của bạn không hỗ trợ phần tử audio.
                        </audio>
                        <p className="text-xs text-gray-500 mt-2 break-all">Link gốc: {question.mediaSource}</p>
                    </div>
                );
            }
            return null;
        }

        // --- Component: ProgressBar.tsx ---
        const ProgressBar = ({ percentage }) => {
            return (
                <div className="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
                    <div
                        className="h-full bg-blue-500 transition-all duration-500 ease-in-out"
                        style={{ width: `${percentage}%` }}
                    ></div>
                </div>
            );
        };
        
        // --- Component: MessageBox.tsx ---
        const MessageBox = ({ message, type }) => {
            const [visible, setVisible] = React.useState(false);

            React.useEffect(() => {
                if (message) {
                    setVisible(true);
                    const timer = setTimeout(() => {
                        setVisible(false);
                    }, 2700);
                    return () => clearTimeout(timer);
                } else {
                    setVisible(false);
                }
            }, [message, type]);

            const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl shadow-xl text-center font-bold text-lg z-50 transition-all duration-300 transform";
            
            const typeClasses = {
                success: 'bg-green-100 border border-green-500 text-green-800',
                error: 'bg-red-100 border-red-500 text-red-800',
                info: 'bg-yellow-100 border border-yellow-500 text-yellow-800',
            };

            const visibilityClasses = visible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none';

            return (
                <div className={`${baseClasses} ${typeClasses[type]} ${visibilityClasses}`}>
                    {message}
                </div>
            );
        };
        
        // --- Component: RationaleBox.tsx ---
        const RationaleBox = ({ question, isCorrect, submittedAnswer }) => {
            const boxClasses = `mt-6 p-4 rounded-xl border transition duration-300 fade-in border-l-4 ${
                isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'
            }`;
            
            const submittedAnswerDisplay = () => {
                const isFillIn = question.type === 'fill-in-the-blank' || (question.type === 'multimedia' && !question.options);
                
                if(isCorrect && !isFillIn) return null;
                
                return (
                    <>
                        <strong className="text-gray-700">
                           Bạn đã chọn/Điền:
                        </strong>
                        <span className="text-red-700 font-medium break-words"> {submittedAnswer}</span>
                        <br/>
                    </>
                );
            }

            return (
                <div className={boxClasses}>
                    <p className="font-bold text-lg mb-2 text-blue-700">Giải thích:</p>
                    <div className="text-gray-700 space-y-1">
                        {!isCorrect && submittedAnswerDisplay()}
                        <p><strong>Đáp án đúng:</strong> <span className="text-green-800 font-semibold">{question.correctAnswer}</span></p>
                        
                        {question.correctAnswer_vi && (
                            <p><strong>Dịch nghĩa:</strong> <span className="text-green-600 font-medium">{question.correctAnswer_vi}</span></p>
                        )}
                        <p className="pt-2 border-t border-gray-300 mt-2">{question.rationale_vi || 'Không có giải thích chi tiết.'}</p>
                    </div>
                </div>
            );
        };

        // --- Component: FillInTheBlankQuestion.tsx ---
        const FillInTheBlankQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex, isCorrect }) => {
            const [inputValue, setInputValue] = React.useState('');
            const inputRef = React.useRef(null);

            React.useEffect(() => {
                setInputValue('');
                if (inputRef.current && !isAnswered) {
                    inputRef.current.focus();
                }
            }, [question, isAnswered]);

            const handleSubmitClick = () => {
                const trimmedInput = inputValue.trim();
                if (trimmedInput === '') {
                    showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
                    return;
                }
                const isCorrectResult = trimmedInput.toLowerCase() === question.correctAnswer.toLowerCase();
                onSubmit(trimmedInput, isCorrectResult);
            };
            
            const questionTextParts = React.useMemo(() => {
                let text = question.question.replace(/^\d+\.\s*/, '');
                
                const markers = ['____', '________', '__________', '___________', '_________', '_______', '______', '_____', '___', '__', '_'];

                for (const marker of markers) {
                    if (text.includes(marker)) {
                        const parts = text.split(marker);
                        return [parts[0], parts.slice(1).join(marker)];
                    }
                }
                 // Handle partial words like `c__se`
                const partialMatch = text.match(/(.*)__+(.*)/) || text.match(/(.*)\_+(.*)/);
                if (partialMatch) {
                    return [partialMatch[1], partialMatch[2]];
                }

                return [text, '']; 
            }, [question.question]);
            
            let inputClasses = 'inline-block mx-2 p-2 border-2 rounded-lg text-xl text-center shadow-sm transition duration-200 align-baseline w-48 font-mono font-bold';
            if (isAnswered) {
                inputClasses += isCorrect ? ' border-green-500 bg-green-50' : ' border-red-500 bg-red-50';
            } else {
                inputClasses += ' border-gray-300 focus:border-blue-500';
            }

            const inputWidthStyle = {
                width: `${Math.max(6, question.correctAnswer.length * 2)}rem`, 
                maxWidth: '100%',
            };


            return (
                <div className="space-y-4">
                     {question.mediaType && <MediaDisplay question={question} showMessage={showMessage} />}
                    <div className="text-2xl sm:text-3xl font-bold mb-6 leading-relaxed text-center flex justify-center items-center flex-wrap">
                        <span className="mr-2">{questionIndex + 1}.</span>
                        {questionTextParts[0] && <span>{questionTextParts[0]}</span>}
                        <input
                            ref={inputRef}
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            disabled={isAnswered}
                            placeholder={isAnswered ? question.correctAnswer : ""}
                            className={inputClasses}
                            style={inputWidthStyle}
                            onKeyPress={(e) => e.key === 'Enter' && !isAnswered && handleSubmitClick()}
                            aria-label="Fill in the blank"
                        />
                        {questionTextParts[1] && <span>{questionTextParts[1]}</span>}
                    </div>
                    <button
                        onClick={handleSubmitClick}
                        disabled={isAnswered}
                        className="w-full py-3 px-4 bg-green-600 text-white font-extrabold text-xl rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                    >
                        Kiểm Tra
                    </button>
                </div>
            );
        };
        
        // --- Component: MultipleChoiceQuestion.tsx ---
        const MultipleChoiceQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [selectedIndex, setSelectedIndex] = React.useState(null);

            React.useEffect(() => {
                setSelectedIndex(null);
            }, [question]);

            const handleSubmitClick = () => {
                if (selectedIndex === null) {
                    showMessage('Vui lòng chọn một đáp án!', 'info');
                    return;
                }
                const selectedOption = question.options[selectedIndex];
                onSubmit(selectedOption.text, selectedOption.isCorrect);
            };

            return (
                <>
                    {question.mediaType && <MediaDisplay question={question} showMessage={showMessage} />}
                    
                    <h3
                        className="text-2xl sm:text-3xl font-bold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className="space-y-3">
                            {question.options.map((option, index) => {
                                const isSelected = selectedIndex === index;
                                let labelClasses = "block p-4 border-2 rounded-xl shadow-md text-xl font-bold transition duration-200";

                                if (isAnswered) {
                                    labelClasses += " cursor-default";
                                    if (option.isCorrect) {
                                        labelClasses += " bg-green-100 border-green-500";
                                    } else if (isSelected) {
                                        labelClasses += " bg-red-100 border-red-500";
                                    } else {
                                        labelClasses += " border-gray-200 opacity-60";
                                    }
                                } else {
                                    labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                                    if(isSelected) {
                                        labelClasses += " bg-blue-100 border-blue-500";
                                    } else {
                                        labelClasses += " border-gray-200";
                                    }
                                }

                                return (
                                    <div key={index} className="relative">
                                        <input
                                            type="radio"
                                            id={`option-${questionIndex}-${index}`}
                                            name={`mc-option-${questionIndex}`}
                                            value={index}
                                            className="hidden"
                                            checked={isSelected}
                                            onChange={() => setSelectedIndex(index)}
                                            disabled={isAnswered}
                                        />
                                        <label htmlFor={`option-${questionIndex}-${index}`} className={labelClasses} dangerouslySetInnerHTML={{ __html: option.text }}></label>
                                    </div>
                                );
                            })}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-3 px-4 bg-green-600 text-white font-extrabold text-xl rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: RearrangeQuestion.tsx ---
        const WordBlock = ({ word, onClick, isSource, isAnswered }) => {
            const baseClasses = 'word-block px-4 py-2 text-xl font-bold rounded-lg shadow-sm transition-all duration-150 break-words transform active:scale-95';
            const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800 border-b-2 border-gray-300';
            const disabledClasses = 'opacity-60 cursor-default shadow-inner';
            const interactiveClasses = 'cursor-pointer';

            return (
                <span
                    onClick={!isAnswered ? onClick : undefined}
                    className={`${baseClasses} ${sourceClasses} ${isAnswered ? disabledClasses : interactiveClasses}`}
                >
                    {word.text}
                </span>
            );
        };

        const RearrangeQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex, isCorrect }) => {
            const [sentenceWords, setSentenceWords] = React.useState([]);
            
            const initialSourceWords = React.useMemo(() => {
                return [...question.words]
                    .map((text) => ({ id: crypto.randomUUID(), text })) 
                    .sort(() => Math.random() - 0.5);
            }, [question]);

            const [sourceWords, setSourceWords] = React.useState(initialSourceWords);

            React.useEffect(() => {
                setSourceWords(initialSourceWords);
                setSentenceWords([]);
            }, [initialSourceWords]);

            const handleSelectWord = (word) => {
                setSourceWords(prev => prev.filter(w => w.id !== word.id));
                setSentenceWords(prev => [...prev, word]);
            };

            const handleReturnWord = (word) => {
                setSentenceWords(prev => prev.filter(w => w.id !== word.id));
                setSourceWords(prev => [...prev, word].sort((a, b) => initialSourceWords.findIndex(sw => sw.id === a.id) - initialSourceWords.findIndex(sw => sw.id === b.id)));
            };

            const handleSubmitClick = () => {
                if (sentenceWords.length === 0) {
                    showMessage('Vui lòng sắp xếp các từ!', 'info');
                    return;
                }
                
                const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
                const normalize = (str) => str.replace(/’/g, "'").replace(/[.,?!]/g, '').replace(/\s+/g, ' ').toLowerCase().trim();
                
                const isCorrectResult = normalize(submitted) === normalize(question.correctAnswer);
                onSubmit(submitted, isCorrectResult);
            };

            return (
                <>
                    <h3
                        className="text-2xl sm:text-3xl font-bold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className={`min-h-[70px] p-3 border-2 rounded-xl shadow-inner flex flex-wrap gap-2 items-center transition duration-300 ${isAnswered ? (isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-blue-300 bg-blue-50 border-dashed'}`}>
                            {sentenceWords.length === 0 && !isAnswered ? (
                                <span className="text-gray-500 italic text-base">Chạm vào các từ bên dưới để xây dựng câu trả lời...</span>
                            ) : (
                                sentenceWords.map(word => (
                                    <WordBlock key={word.id} word={word} onClick={() => handleReturnWord(word)} isSource={false} isAnswered={isAnswered} />
                                ))
                            )}
                        </div>
                        
                        <div className="min-h-[120px] p-4 bg-gray-100 rounded-xl shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                            {sourceWords.map(word => (
                                <WordBlock key={word.id} word={word} onClick={() => handleSelectWord(word)} isSource={true} isAnswered={isAnswered} />
                            ))}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-3 px-4 bg-green-600 text-white font-extrabold text-xl rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: StartScreen.tsx ---
        const StartScreen = ({ onStart, totalQuestions, testName }) => {
            const [name, setName] = React.useState('');

            const handleStart = () => {
                if (name.trim()) {
                    onStart(name.trim());
                }
            };

            const isButtonDisabled = name.trim() === '';

            return (
                <div className="fade-in text-center p-4">
                    <header className="mb-8">
                        <h1 className="text-4xl sm:text-5xl font-extrabold text-blue-600 mb-2">{testName}</h1>
                        <p className="text-xl text-gray-500">Bộ đề luyện thi IOE dành cho khối 4</p>
                    </header>
                    <div className="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <h2 className="text-2xl font-bold mb-4 text-gray-700">Chào mừng bạn!</h2>
                        <p className="text-gray-600 mb-6 text-lg">Mỗi câu trả lời đúng được cộng 10 điểm. Bài thi có {totalQuestions} câu.</p>
                        <div className="space-y-4">
                            <label htmlFor="player-name" className="block text-base font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                            <input
                                type="text"
                                id="player-name"
                                placeholder="Tên của bạn"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm transition duration-150"
                                maxLength={50}
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && !isButtonDisabled && handleStart()}
                            />
                            <button
                                onClick={handleStart}
                                disabled={isButtonDisabled}
                                className="w-full py-3 px-4 bg-yellow-400 text-yellow-900 font-extrabold rounded-xl shadow-lg transition duration-300 hover:bg-yellow-500 disabled:bg-gray-300 disabled:cursor-not-allowed text-2xl active:scale-98"
                            >
                                Bắt Đầu
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- Component: EndScreen.tsx ---
        const EndScreen = ({ playerName, score, totalQuestions, onRestart, onReview, testName }) => {
            const maxScore = totalQuestions * 10;
            const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;
            
            let encouragement = "Cố gắng hơn ở lần sau nhé!";
            if (percentage >= 90) {
                encouragement = "Xuất sắc! Bạn thật là giỏi!";
            } else if (percentage >= 70) {
                encouragement = "Làm tốt lắm! Chỉ cần cố gắng thêm một chút nữa thôi.";
            } else if (percentage >= 50) {
                encouragement = "Khá tốt! Hãy tiếp tục ôn luyện nhé.";
            }

            return (
                <div className="text-center fade-in p-4">
                    <h2 className="text-4xl font-extrabold mb-2 text-green-600">🎉 Hoàn Thành! 🎉</h2>
                    <p className="text-2xl text-gray-700 mb-2">
                        Chúc mừng, <span className="font-extrabold text-blue-600">{playerName}</span>!
                    </p>
                    <p className="text-xl text-gray-600 mb-4">
                        Bạn đã hoàn thành bài thi <span className="font-bold text-blue-600">{testName}</span>.
                    </p>
                     <p className="text-lg text-gray-500 mb-6">{encouragement}</p>
                    <div className="bg-white p-8 rounded-xl shadow-lg inline-block border border-gray-100">
                        <p className="text-2xl font-bold mb-8 text-gray-700">Điểm số của bạn:</p>
                        <p className={`text-7xl font-black mb-10 text-blue-700`}>
                            {score} / {maxScore}
                        </p>
                    </div>
                    <div className="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                        {onReview && (
                             <button
                                onClick={onReview}
                                className="py-3 px-6 bg-yellow-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-yellow-600 text-lg active:scale-98"
                            >
                                Xem lại câu sai
                            </button>
                        )}
                        <button
                            onClick={onRestart}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >
                            Làm lại bài thi
                        </button>
                    </div>
                </div>
            );
        };

        // --- Component: ReviewScreen.tsx ---
        const ReviewScreen = ({ incorrectAnswers, onBack, testName }) => {
            return (
                <div className="fade-in">
                    <header className="text-center mb-8">
                        <h1 className="text-4xl sm:text-5xl font-extrabold text-yellow-600 mb-2">Ôn tập các câu sai</h1>
                        <p className="text-xl text-gray-500">Bài thi: {testName}</p>
                    </header>
                    <div className="space-y-8">
                        {incorrectAnswers.map(({ question, submittedAnswer }, index) => (
                            <div key={index} className="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                                <h3 className="text-2xl sm:text-3xl font-bold mb-4 leading-relaxed"
                                    dangerouslySetInnerHTML={{ __html: `${index + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                                />
                                {question.mediaType && <MediaDisplay question={question} showMessage={() => {}} />}
                                <RationaleBox question={question} isCorrect={false} submittedAnswer={submittedAnswer} />
                            </div>
                        ))}
                    </div>
                    <div className="mt-8 text-center">
                        <button
                            onClick={onBack}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >
                            Quay lại màn hình điểm
                        </button>
                    </div>
                </div>
            );
        };
        
        // --- Component: QuizScreen.tsx ---
        const QuizScreen = ({ playerName, onEnd, totalQuestions, questionSet, testName }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
            const [score, setScore] = React.useState(0);
            const [isAnswered, setIsAnswered] = React.useState(false);
            const [isCorrect, setIsCorrect] = React.useState(false);
            const [submittedAnswer, setSubmittedAnswer] = React.useState('');
            const [isHintVisible, setIsHintVisible] = React.useState(false);
            const [message, setMessage] = React.useState(null);
            const incorrectAnswersRef = React.useRef([]);
            
            const currentQuestion = questionSet[currentQuestionIndex];

            React.useEffect(() => {
                incorrectAnswersRef.current = [];
            }, [questionSet]);

             React.useEffect(() => {
                setIsAnswered(false);
                setIsCorrect(false);
                setSubmittedAnswer('');
                setIsHintVisible(false);
                setMessage(null);
            }, [currentQuestionIndex]);
            
            const showMessage = (text, type) => {
                setMessage({ text, type });
            };

            const handleSubmit = (answer, isAnswerCorrect) => {
                if (isAnswered) return;
                
                setIsAnswered(true);
                setSubmittedAnswer(answer);
                setIsCorrect(isAnswerCorrect);

                if (isAnswerCorrect) {
                    setScore(prev => prev + 10);
                    showMessage('CHÍNH XÁC! +10 điểm', 'success');
                } else {
                    showMessage('SAI RỒI! Hãy xem lại nhé.', 'error');
                    incorrectAnswersRef.current.push({ question: currentQuestion, submittedAnswer: answer });
                }
            };

            const handleNext = () => {
                if (currentQuestionIndex < totalQuestions - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    onEnd(score, incorrectAnswersRef.current);
                }
            };

            if (!currentQuestion) {
                return <div className="text-center p-8">Đang tải câu hỏi...</div>;
            }

            const progressPercentage = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            
            const renderQuestionComponent = () => {
                const commonProps = {
                    question: currentQuestion,
                    isAnswered,
                    onSubmit: handleSubmit,
                    showMessage,
                    questionIndex: currentQuestionIndex,
                    isCorrect: isCorrect, 
                };

                if (currentQuestion.type === 'rearrange') {
                    return <RearrangeQuestion {...commonProps} />;
                }
                if (currentQuestion.type === 'mc' || (currentQuestion.type === 'multimedia' && currentQuestion.options)) {
                    return <MultipleChoiceQuestion {...commonProps} />;
                }
                if (currentQuestion.type === 'fill-in-the-blank' || (currentQuestion.type === 'multimedia' && !currentQuestion.options)) {
                    return <FillInTheBlankQuestion {...commonProps} />;
                }
                
                return <div className="text-red-500">Lỗi: Loại câu hỏi không xác định.</div>;
            };

            return (
                <div className="fade-in">
                    {message && <MessageBox message={message.text} type={message.type} />}
                    <header className="text-center mb-8">
                        <h1 className="text-4xl sm:text-5xl font-extrabold text-blue-600 mb-2">{testName}</h1>
                        <ProgressBar percentage={progressPercentage} />
                    </header>

                    <div className="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-xl shadow-inner border border-blue-100">
                        <p className="text-lg font-medium text-blue-800">Bạn: <span className="font-bold">{playerName}</span></p>
                        <p className="text-lg font-medium text-blue-800">Điểm: <span className="text-2xl font-extrabold text-red-600">{score}</span></p>
                        <p className="text-lg font-medium text-blue-800">Câu: <span className="font-bold">{currentQuestionIndex + 1}/{totalQuestions}</span></p>
                    </div>

                    <div className="mb-8">
                        {renderQuestionComponent()}
                    </div>

                    <div className="mt-8 border-t pt-6 flex justify-between items-center flex-wrap gap-4">
                        <div className="relative">
                            <button
                                className="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                                onMouseEnter={() => setIsHintVisible(true)}
                                onMouseLeave={() => setIsHintVisible(false)}
                                onTouchStart={() => setIsHintVisible(true)}
                                onTouchEnd={() => setIsHintVisible(false)}
                            >
                                Gợi ý
                            </button>
                            <div className={`absolute bottom-full mb-2 w-max max-w-[90vw] sm:max-w-sm p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-xl shadow-lg transition-all duration-300 transform origin-bottom-left ${isHintVisible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none'}`}>
                                <p className="font-semibold text-yellow-800">Gợi ý:</p>
                                <p className="text-yellow-700">{currentQuestion.hint_vi || 'Không có gợi ý.'}</p>
                            </div>
                        </div>
                        
                        <button onClick={handleNext} disabled={!isAnswered} className="flex-grow py-3 px-4 bg-blue-500 text-white font-extrabold text-xl rounded-xl shadow-xl transition duration-300 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98">
                            {currentQuestionIndex === totalQuestions - 1 ? 'Hoàn thành' : 'Câu tiếp theo'}
                        </button>
                    </div>

                    {isAnswered && (
                        <RationaleBox question={currentQuestion} isCorrect={isCorrect} submittedAnswer={submittedAnswer} />
                    )}
                </div>
            );
        };
        
        // --- Component: App.tsx ---
        const App = () => {
            const [gameState, setGameState] = React.useState('start');
            const [playerName, setPlayerName] = React.useState('');
            const [score, setScore] = React.useState(0);
            const [shuffledQuestions, setShuffledQuestions] = React.useState([]);
            const [incorrectAnswers, setIncorrectAnswers] = React.useState([]);
            const testName = "BỘ ĐỀ ÔN IOE K4 SỐ: 02.1";

            React.useEffect(() => {
                const array = [...questions];
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                setShuffledQuestions(array);
            }, []);

            const handleStartQuiz = (name) => {
                setPlayerName(name);
                setScore(0);
                setIncorrectAnswers([]);
                setGameState('quiz');
            };

            const handleEndQuiz = (finalScore, mistakes) => {
                setScore(finalScore);
                setIncorrectAnswers(mistakes);
                setGameState('end');
            };
            
            const handleRestartQuiz = () => {
                 const array = [...questions];
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                setShuffledQuestions(array);
                setGameState('start');
            };

            const handleReview = () => {
                setGameState('review');
            };

             const handleBackToEndScreen = () => {
                setGameState('end');
            };

            const renderContent = () => {
                switch (gameState) {
                    case 'quiz':
                        return <QuizScreen 
                                    playerName={playerName} 
                                    onEnd={handleEndQuiz} 
                                    totalQuestions={shuffledQuestions.length}
                                    questionSet={shuffledQuestions}
                                    testName={testName}
                                />;
                    case 'end':
                        return <EndScreen 
                                    playerName={playerName} 
                                    score={score} 
                                    totalQuestions={shuffledQuestions.length}
                                    onRestart={handleRestartQuiz} 
                                    onReview={incorrectAnswers.length > 0 ? handleReview : null}
                                    testName={testName}
                                />;
                    case 'review':
                        return <ReviewScreen 
                                    incorrectAnswers={incorrectAnswers}
                                    onBack={handleBackToEndScreen}
                                    testName={testName}
                                />;
                    default:
                         return <StartScreen onStart={handleStartQuiz} totalQuestions={questions.length} testName={testName} />;
                }
            };

            return (
                <div className="p-4 sm:p-8 flex justify-center items-start min-h-screen">
                    <div className="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
                        {renderContent()}
                    </div>
                </div>
            );
        };
        
        // --- Entry point from index.tsx ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
